<div class="section-observations-filter">
  <div class="col-md-12">
    <div style="float: left; margin-right: 10px">
      <p-toggleButton
        onLabel="{{ 'observations.showTable' | translate }}"
        offLabel="{{ 'observations.showTable' | translate }}"
        onIcon="fa fa-table"
        offIcon="fa fa-table"
        [(ngModel)]="showTable"
      ></p-toggleButton>
    </div>
    <div style="float: left; background-color: rgba(256,256,256,.6); padding: 5px; border-radius: 5px; margin-top: 1px;">
      <p style="margin: 0">{{ "observations.withoutCoordinates" | translate }} <b>{{ observationsWithoutCoordinates }}</b></p>
    </div>
    <div style="float: right;">
      <button
        type="button"
        pButton
        icon="pi pi-plus"
        (click)="newObservation()"
        label="{{ 'observations.button.add' | translate }}"
        class="ui-button-primary"
      ></button>
    </div>
  </div>
</div>

<div class="row">
  <div class="section-observations-map col-md-12">
    <div class="section-map observations-map" id="observationsMap" #observationsMap></div>
  </div>
  <div [ngStyle]="{ display: showTable ? '' : 'none' }" class="col-md-12 section-observations-table">
    <div class="card" style="height: 100%;">
      <div class="card-header">{{ "sidebar.observations" | translate }}</div>
      <div class="card-block" style="overflow-y: auto;">
        <div>
          <app-observation-table #observationTable [observations]="observations" (observationClick)="onObservationClick($event)"></app-observation-table>
        </div>
      </div>
    </div>
  </div>
</div>

<leaflet-sidebar-control
    [map]="mapService.observationsMap"
    [options]="mapService.sidebarOptions"
    (change$)="onSidebarChange($event)"
></leaflet-sidebar-control>

<div id="sidebar" #sidebar class="leaflet-sidebar collapsed observations-sidebar">
  <!-- Nav tabs -->
  <div class="leaflet-sidebar-tabs">
      <ul role="tablist"> <!-- top aligned tabs -->
        <li><a href="#filter" role="tab"><i class="fa fa-filter"></i></a></li>
        <li><a href="#layers" role="tab"><i class="fa fa-navicon"></i></a></li>
        <li><a href="#sources" role="tab"><i class="fa fa-database"></i></a></li>
      </ul>

      <ul role="tablist"> <!-- bottom aligned tabs -->
        <li><a href="#legend" role="tab"><i class="fa fa-question-circle-o"></i></a></li>
      </ul>
  </div>
  <!-- Tab panes -->
  <div class="leaflet-sidebar-content">
    <div class="leaflet-sidebar-pane" id="filter">
      <h1 class="leaflet-sidebar-header" style="padding-left: 20px">
        {{ "observations.sidebar.filter.title" | translate }}
      </h1>
      <div style="margin: 10px 0">
        <p-calendar [(ngModel)]="dateRange" selectionMode="range" [showIcon]="true" dateFormat="dd.mm.yy"></p-calendar>
        <button type="button" pButton class="ui-button-secondary" (click)="loadObservations({days: 1})" label="1d"></button>
        <button type="button" pButton class="ui-button-secondary" (click)="loadObservations({days: 2})" label="2d"></button>
        <button type="button" pButton class="ui-button-secondary" (click)="loadObservations({days: 3})" label="3d"></button>
        <button type="button" pButton class="ui-button-secondary" (click)="loadObservations({days: 7})" label="7d"></button>
      </div>
      <div style="margin: 10px 0">
        <div class="ui-inputgroup">
          <span class="ui-inputgroup-addon"><i class="fa fa-arrows-v"></i></span>
          <input style="width: 50px" type="text" step="100" min="0" max="9000" pInputText [(ngModel)]="elevationRange[0]" />
          <span class="ui-inputgroup-addon">&mdash;</span>
          <input style="width: 50px" type="text" pInputText [(ngModel)]="elevationRange[1]" />
          <span class="ui-inputgroup-addon">m</span>
        </div>
      </div>
      <div style="margin: 10px 0">
        <app-aspects [(aspects)]="aspects" [size]="100"></app-aspects>
      </div>
      <div style="margin: 10px 0">
        <select [(ngModel)]="regions" [multiple]="true" [size]="5" style="max-width: 100%;">
          <option *ngFor="let region of allRegions" [value]="region.id">{{region.id}} {{region.name}}</option>
      </select>
      </div>
      <div style="margin: 10px 0">
        <button
          type="button"
          pButton
          class="ui-button-success"
          (click)="loadObservations()"
          [icon]="loading ? 'pi pi-spin pi-spinner' : 'pi pi-refresh'"
        ></button>
      </div>
    </div>
    <div class="leaflet-sidebar-pane" id="layers">
      <h1 class="leaflet-sidebar-header" style="padding-left: 20px">
        {{ "observations.sidebar.views.title" | translate }}
      </h1>
      <div id="typesDiv" style="margin: 10px 0"></div>
    </div>
    <div class="leaflet-sidebar-pane" id="sources">
      <h1 class="leaflet-sidebar-header" style="padding-left: 20px">
        {{ "observations.sidebar.sources.title" | translate }}
      </h1>
      <div id="sourcesDiv" style="margin: 10px 0"></div>
    </div>
    <div class="leaflet-sidebar-pane" id="legend">
      <h1 class="leaflet-sidebar-header" style="padding-left: 20px">
        {{ "observations.sidebar.legend.title" | translate }}
      </h1>
      <p>Lorem ipsum ...</p>
    </div>
  </div>
</div>

<p-dialog [(visible)]="observationPopupVisible" [modal]="true" [style]="{ width: '80vw' }" [closeOnEscape]="true" [dismissableMask]="true">
  <p-header>
    <span [style]="{ color: observationPopup?.observation?.$markerColor }" [title]="observationPopup?.observation?.$source">â–ˆ</span>
    {{ observationPopup?.observation?.locationName }}
  </p-header>
  <table *ngIf="observationPopup" class="table table-sm">
    <tr *ngFor="let row of observationPopup.table">
      <th style="padding-right: 1ex">{{ row.label }}</th>
      <td>
        <span *ngIf="row.date !== undefined">{{ row.date | localizedDate: "full" }}</span>
        <span *ngIf="row.number !== undefined">{{ row.number | number }}</span>
        <span *ngIf="row.boolean !== undefined"><i [class]="row.boolean ? 'pi pi-check' : 'pi pi-times'"></i></span>
        <span *ngIf="row.value !== undefined">{{ row.value }}</span>
        <span *ngIf="row.date === undefined && row.number === undefined && row.boolean === undefined && row.value === undefined"
          >&mdash;</span
        >
      </td>
    </tr>
  </table>
  <iframe *ngIf="observationPopup?.iframe" sandbox="allow-forms allow-same-origin allow-scripts" [src]="observationPopup?.iframe" style="margin-top: 1ex; width: 100%; height: 80vh;"></iframe>
</p-dialog>
