<!-- !layout -->
<div class="layout">

  <div class="layout-observations">

    <div class="layout-left">
      <div class="layout-global">
        <div>
          <p-toggleButton onLabel="{{ 'observations.showTable' | translate }}"
            offLabel="{{ 'observations.showTable' | translate }}" onIcon="fa fa-table" offIcon="fa fa-table"
            [(ngModel)]="showTable"></p-toggleButton>


          <p style="margin: 0">{{ "observations.withoutCoordinates" | translate }}
            <b>{{ observationsWithoutCoordinates }}</b></p>


          <button type="button" pButton class="ui-button-success" (click)="exportObservations()"
            style="margin-right: 10px">
            Export ({{observations.length}})
          </button>
          <button type="button" pButton icon="pi pi-plus" (click)="newObservation()"
            label="{{ 'observations.button.add' | translate }}" class="ui-button-primary"></button>
        </div>
        <div>
          <p-calendar [(ngModel)]="filter.dateRange" selectionMode="range" [showIcon]="true" dateFormat="dd.mm.yy">
          </p-calendar>
          <button type="button" pButton class="ui-button-secondary" (click)="loadObservations({days: 1})"
            label="1d"></button>
          <button type="button" pButton class="ui-button-secondary" (click)="loadObservations({days: 2})"
            label="2d"></button>
          <button type="button" pButton class="ui-button-secondary" (click)="loadObservations({days: 3})"
            label="3d"></button>
          <button type="button" pButton class="ui-button-secondary" (click)="loadObservations({days: 7})"
            label="7d"></button>
        </div>
        <div>
          <div class="ui-inputgroup">
            <span class="ui-inputgroup-addon"><i class="fa fa-arrows-v"></i></span>
            <input style="width: 50px" type="text" step="100" min="0" max="9000" pInputText
              [(ngModel)]="filter.elevationRange[0]" (change)="applyLocalFilter()" />
            <span class="ui-inputgroup-addon">&mdash;</span>
            <input style="width: 50px" type="text" pInputText [(ngModel)]="filter.elevationRange[1]"
              (change)="applyLocalFilter()" />
            <span class="ui-inputgroup-addon">m</span>
          </div>
        </div>
        <div>
          <app-aspects [(aspects)]="filter.aspects" [size]="100"></app-aspects>
        </div>
        <div>
          <ng-multiselect-dropdown
            placeholder="{{ 'observations.selectRegion.placeholder' | translate }}"
            [settings]="dropdownSettings"
            [data]="allRegions"
            [(ngModel)]="selectedItems"
            (onSelect)="onRegionSelect($event)"
            (onDeSelect)="onRegionDeSelect($event)"
          >
          </ng-multiselect-dropdown>
        </div>
        <div>
          <button type="button" pButton class="ui-button-success" (click)="loadObservations()"
            [icon]="loading ? 'pi pi-spin pi-spinner' : 'pi pi-refresh'"></button>
        </div>

        <div class="leaflet-sidebar-pane" id="layers">
          <h1 class="leaflet-sidebar-header" style="padding-left: 20px">
            {{ "observations.sidebar.views.title" | translate }}
          </h1>
          <div id="typesDiv"></div>
        </div>
        <div class="leaflet-sidebar-pane" id="sources">
          <h1 class="leaflet-sidebar-header" style="padding-left: 20px">
            {{ "observations.sidebar.sources.title" | translate }}
          </h1>
          <div id="sourcesDiv"></div>
        </div>
        <div class="leaflet-sidebar-pane" id="legend">
          <h1 class="leaflet-sidebar-header" style="padding-left: 20px">
            {{ "observations.sidebar.legend.title" | translate }}
          </h1>
          <p>Lorem ipsum ...</p>
        </div>
        <input type="checkbox" id="global_open" />
      </div>
      <div class="layout-map">
        <div class="" style="top:0px; width:100%; height: calc(100vh - 120px);">
          <div class="section-map observations-map" id="observationsMap" #observationsMap></div>
        </div>

      </div>

    </div>

    <div class="layout-right">
      <div class="layout-charts">
        <app-observations-local-filter [filter]="filter" [observations]="observations"></app-observations-local-filter>
      </div>
    </div>

  </div>

  <div [ngStyle]="{ display: showTable ? '' : 'none' }" class="col-md-12 section-observations-table">
    <div class="card" style="height: 100%;">
      <div class="card-header">{{ "sidebar.observations" | translate }}</div>
      <div class="card-block" style="overflow-y: auto;">
        <div>
          <app-observation-table #observationTable [observations]="observations"
            (observationClick)="onObservationClick($event)"></app-observation-table>
        </div>
      </div>
    </div>
  </div>

</div>
<!-- /layout -->









<p-dialog #observationDialog (onShow)="observationDialog.maximize()" [(visible)]="observationPopupVisible"
  [modal]="true" [style]="{ width: '80vw' }" [closeOnEscape]="true" [dismissableMask]="true" [maximizable]="true">
  <p-header>
    <span [style]="{ color: toMarkerColor(observationPopup?.observation) }"
      [title]="observationPopup?.observation?.$source">â–ˆ</span>
    {{ observationPopup?.observation?.locationName }}
  </p-header>
  <table *ngIf="observationPopup" class="table table-sm">
    <tr *ngFor="let row of observationPopup.table">
      <th style="padding-right: 1ex">{{ row.label }}</th>
      <td>
        <span *ngIf="row.date !== undefined">{{ row.date | localizedDate: "full" }}</span>
        <span *ngIf="row.number !== undefined">{{ row.number | number }}</span>
        <span *ngIf="row.boolean !== undefined"><i [class]="row.boolean ? 'pi pi-check' : 'pi pi-times'"></i></span>
        <span *ngIf="row.url !== undefined"><a href="{{ row.url }}" rel="noopener"
            target="_blank">{{ row.url }}</a></span>
        <span *ngIf="row.value !== undefined">{{ row.value }}</span>
        <span
          *ngIf="row.date === undefined && row.number === undefined && row.boolean === undefined && row.url === undefined && row.value === undefined">&mdash;</span>
      </td>
    </tr>
  </table>
  <iframe *ngIf="observationPopup?.iframe" [src]="observationPopup?.iframe" style="width: 100%; height: 80vh;"></iframe>
</p-dialog>
